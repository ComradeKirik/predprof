<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Predprof</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=4">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/task_selection.css') }}?v=1">
</head>

<body>

    <header class="navbar">
        <div class="logo"><a href="{{ url_for('mainpage') }}">üéì Predprof</a></div>
        <div class="nav-right">
            <!-- Theme Toggle -->
            <button id="theme-toggle" class="btn btn-outline"
                style="padding: 5px 10px; margin-right: 15px; font-size: 1.2rem; border: none;"
                title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                üåì
            </button>

            {% if loggedin %}
            <a href="{{ url_for('account') }}" title="–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å">
                <img src="{{ profile_pic }}" alt="–ü—Ä–æ—Ñ–∏–ª—å" class="profile-pic">
            </a>
            {% else %}
            <a href="{{ url_for('login') }}" title="–í–æ–π—Ç–∏">
                <img src="/static/profile_pics/generic_profile_picture.jpg" alt="–ü—Ä–æ—Ñ–∏–ª—å" class="profile-pic">
            </a>
            {% endif %}
        </div>
    </header>

    <script>
        // Immediate theme application to prevent flash
        (function () {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();

        document.addEventListener('DOMContentLoaded', function () {
            const toggleBtn = document.getElementById('theme-toggle');

            // Update icon based on current theme
            function updateIcon() {
                const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                toggleBtn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            }
            updateIcon();

            toggleBtn.addEventListener('click', function () {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateIcon();
            });
        });
    </script>
    <br>
    {% block content %}
    {% endblock %}

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        var socket = io();
        socket.on("message", function (data) {
            console.log('–°–æ–æ–±—â–µ–Ω–∏–µ: ' + data)
        });

        function sendMessage() {
            var msgInput = document.getElementById("msg");
            var message = msgInput.value;
            socket.send(message);
            msgInput.value = "";
        }
    </script>